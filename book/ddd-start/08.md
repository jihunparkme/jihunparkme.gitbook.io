---
description: 도메인 주도 개발 시작하기 8장을 요약한 내용입니다.
---

# 애그리거트 트랜잭션 관리

트랜잭션마다 리포지터리는 새로운 애그리거트 객체를 생성하므로 운영자 스레드와 고객 스레드는 같은 주문 애그리거트를 나타내는 다른 객체를 구하게 된다.

운영자 스레드와 고객 스레드는 **개념적으로 동일한 애그리거트지만 물리적으로 서로 다른 애그리거트 객체를 사용**한다.
- 운영자 스레드가 주문 애그리거트 객체를 배송 상태로 변경하더라도 고객 스레드가 사용하는 주문 애그리거트 객체에는 영향을 주지 않는다.
- 두 스레드는 각각 트랜잭션을 커밋할 때 수정한 내용을 DB에 반영한다.
- 운영자는 기존 배송지 정보를 이용해서 배송 상태로 변경했는데, 그 사이 고객은 배송지 정보를 변경했다는 문제가 발생하여 **애그리거트의 일관성이 꺠지게 된다.**

일관성이 깨지는 문제가 발생하지 않도록 하려면 다음 두 가지 중 하나를 해야 한다.
- 운영자가 배송지 정보를 조회하고 상태를 변경하는 동안, 고객이 애그리거트를 수정하지 못 하도록 막기
- 운영자가 배송지 정보를 조회한 이후 고객이 정보를 변경하면, 운영자가 애그리거트를 다시 조회한 뒤 수정하도록 하기

이 두 가지는 애그리거트 자체의 트랜잭션과 관련이 있는데, DBMS가 지원하는 트랜잭션과 함께 애그리거트를 위한 추가적인 트랜잭션 처리 기법이 필요하다. 대표적으로 애그리거트 자체 트랜잭션 처리 방식은 두 가지 방식이 있다.
- 선점 잠금(Pessimistic Lock)
- 비선점 잠금(Optimistic Lock)





# 09.도메인 모델과 바운디드 컨텍스트

# 10.이벤트

# 11.CQRS