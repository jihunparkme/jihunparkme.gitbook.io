# 표현 영역과 응용 영역

도메인 영역을 잘 구현하지 않으면 사용자의 요구를 충족하는 제대로 된 소프트웨어를 만들지 못한다.

도메인 영역이 제 기능을 하려면 사용자와 도메인을 연결해 주는 매개체가 필요하다.

**`응용 영역`과 `표현 영역`이 사용자와 도메인을 연결해 주는 매개체 역할**을 한다.

```text
사용자 -> 표현 영역 -> 응용 영역 -> 도메인 영역
```

`표현 영역`은 **사용자의 요청을 해석**한다.
- 사용자가 HTTP 요청을 **표현 영역에 전달**.
- 요청을 받은 표현 영역은 URL, 요청 파라미터, 쿠키, 헤더 등을 이용해서 사용자가 실행하고 싶은 기능을 판별하고 그 기능을 제공하는 **응용 서비스 실행**

`응용 영역`에 위치한 서비스는 **실제 사용자가 원하는 기능을 제공**한다.
- 응용 서비스는 기능을 실행하는 데 필요한 입력 값을 메서드 인자로 받고 실행 결과를 리턴
- 응용 서비스의 메서드가 요구하는 파라미터와 표현 영역이 사용자로부터 전달받은 데이터는 형식이 일치하지 않으므로 **표현 영역은 응용 서비스가 요구하는 형식으로 사용자 요청을 변환**
- 응용 서비스를 실행한 뒤 표현 영역은 실행 결과를 **사용자에게 알맞은 형식**(HTML, JSON)으로 응답
- 사용자와 상호작용은 표현 영역이 처리하므로 응용 서비스는 **표현 영역에 의존하지 않고**, 단지 **기능 실행에 필요한 입력 값을 받고 실행 결과만 리턴**하면 된다.

# 응용 서비스의 역할

응용 서비스는 **사용자(클라이언트)가 요청한 기능을 실행**
- 사용자의 요청을 처리하기 위해 리포지터리에서 **도메인 객체를 가져와 사용**
- 도메인 객체를 사용해서 요청을 처리하므로 도메인 영역과 표현 영역을 연결해 주는 창구 역할
- 주로 도메인 객체 간의 흐름을 제어

도메인 객체 간의 흐름을 제어하는 단순한 형태의 응용 서비스

```java
public Result doSomeFunc(SomeReq req) {
    // 1. 리포지터리에서 애그리거트 조회
    SomeAgg agg = someAggRepository.findById(req.getId());
    checkNull(agg);

    // 2. 애그리거트의 도메인 기능을 실행
    agg.doFunc(req.getValue());

    // 3. 결과를 리턴
    return createSuccessResult(agg);
}
```

새로운 애그리거트를 생성하는 응용 서비스

```java
public Result doSomeCreation(CreateSomeReq req) {
    // 1, 데이터 중복 등 데이터가 유효한지 검사
    validate(req);

    // 2. 애그리거트 생성
    SomeAgg newAgg = createSome(req);

    // 3. 리포지터리에 애그리거트 저장
    someAggRepository.save(newAgg);

    // 4. 결과를 리턴
    return createSuccessResult(newAgg);
}
```

응용 서비스가 복잡하다면 **응용 서비스에서 도메인 로직의 일부를 구현하고 있을 가능성**이 높다.
- 코드 중복, 로직 분산 등 코드 품질에 안 좋은 영향을 줄 수 있다.

응용 서비스는 **트랜잭션 처리도 담당**한다.
- 도메인 상태 변경을 트랜잭션으로 처리
- 트랜잭션 범위에서 응용 서비스를 실행해서 데이터 일관성이 깨지는 이슈를 방지

그 외에도 응용 서비스는 접근 제어와 이벤트 처리도 담당

## 도메인 로직 넣지 않기

도메인 로직은 도메인 영역에 위치하고 응용 서비스는 도메인 로직을 구현하지 않아야 한다.

도멩니 로직을 도메인 영역과 응용 서비스에 분산해서 구현하면 코드 품질에 문제가 발생한다.
- 첫 번째 문제: **코드의 응집성이 떨어진다.**
  - 도메인 로직 파악을 위해 여러 영역을 분산해야 한다.
- 두 번째 문제: **여러 응용 서비스에서 동일한 도메인 로직을 구현할 가능성이 높아진다.**
  - 도메인 객체에 기능을 구현하고 응용 서비스에서 도메인이 제공하는 기능을 사용하면 코드 중복 문제는 방생하지 않는다.

> 변경이 용이한 소프트웨어의 가치를 높이려면 도메인 로직을 도메인 영역에 모아서 코드 중복을 줄이고 응집도를 높여야 한다.











# 07. 도메인 서비스

# 08. 애그리거트 트랜잭션 관리

# 09. 도메인 모델과 바운디드 컨텍스트

# 10. 이벤트

# 11. CQRS