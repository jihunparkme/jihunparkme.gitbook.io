---
description: 도메인 주도 개발 시작하기 7장을 요약한 내용입니다.
---

# 여러 애그리거트가 필요한 기능

도메인 영역 코드를 작성하다 보면, 한 애그리거트로 기능 구현이 어려울 때가 있다.

대표적으로 결제 금액 계산 로직은 아래와 같은 내용이 필요하다.
- 상품 애그리거트: 구매하는 상품의 가격 필요. 상품에 따라 배송비가 추가
- 주문 애그리거트: 상품별로 구매 개수 필요
- 할인 쿠폰 애그리거트: 쿠폰별로 지정한 할인 금액이나 비율에 따라 주문 총 금액 할인. 할인 쿠폰을 조건에 따라 중복 사용하거나 지정 카테고리 상품에만 적용 가능한 제약 조건이 있다면 할인 계산이 복잡
- 회원 애그리거트: 회원 등급에 따라 추가 할인 가능

이 상황에서 실제 결제 금액을 계산해야 하는 주체는 어떤 애그리거트일까?

주문 애그리거트가 필요한 데이터를 모두 가지도록 한 뒤 할인 금액 계산 책임을 주문 애그리거트에 할당해 보자.
- calculatePayAmount()
  - 쿠폰별로 할인 금액 구하기
  - 회언에 따른 추가 할인 구하기
  - 실제 결제 금액 계산
  - ...
- calculateDiscount(Coupon coupon)
  - orderLines 각 상품에 대해 쿠폰을 적용해서 할인 금액 계산
  - 쿠폰 적용 조건 등을 확인
  - 정책에 따라 복잡한 조건문 계산
  - ...
- calculateDiscount(MemberGrade grade)
  - 등급에 따라 할인 금액 계산
  - ...

**한 애그리거트에 넣기 애매한 도메인 기능을 억지로 특정 애그리거트에 구현하면 안 된다.**
- 억지로 구현하면 애그리거트는 자신의 책임 범위를 넘어서는 기능을 구현하므로 코드가 길어지고, 외부에 대한 의존이 높아지고, 코드를 복잡하게 만들어 수정을 어렵게 만든다.
- 추가로 애그리거트의 범위를 넘어서는 도메인 개념이 애그리거트에 숨어들어 명시적으로 드러나지 않게 된다.

> 도메인 기능을 별도 서비스로 구현해 보자.

# 도메인 서비스















# 08. 애그리거트 트랜잭션 관리

# 09. 도메인 모델과 바운디드 컨텍스트

# 10. 이벤트

# 11. CQRS