---
description: 대규모 시스템 설계 기초 13장을 요약한 내용입니다.
---

검색어 자동 완성
- autocomplete
- typehead
- search-as-you-type
- incremental search

> 많이 이용된 검색어 k개를 자동완성하여 출력하는 시스템 설계

# 1단계: 문제 이해 및 설계 범위 확정

- 사용자 입력 단어는 자동완성될 검색어의 첫 부분
- 5개의 자동완성 검색이 표시
- 5개는 질의 빈도에 따러 정해지는 검색어 인기 순위 기준
- 맞춤법 검사나 자동수정은 미지원
- 질의는 영어 + 다국어
- 모든 질의는 영어 소문자
- 일간 능동 사융자(DAU) 천만(10million)

## 요구사항

**빠른 응답 속도**

- 페이스북 검색어 자동완성 시스템에 관한 문서를 보면 시스템 응답속도는 100밀리초 이내여야 한다. 그렇지 않으면 시스템이 불편해진다.

**연관성**

- 자동완성되어 출력되는 검색어는 사용자가 입력한 단어와 연관된 것이어야 한다.

**정렬**

- 시스템의 계산 결과는 인기도, 등의 순위 모델에 의해 정렬

**규모 확장성**

- 시스템은 많은 트래픽을 감당할 수 있도록 확장 가능해야 한다.

**고가용성**

- 시스템의 일부에 장애가 발생하거나, 느려지거나, 예상치 못한 네트워크 문제가 생겨도 시스템은 계속 사용 가능해야 한다.

## 개략적 규모 추정

- 일간 능동 사용자(DAU)는 천만 명으로 가정
- 평균적으로 한 사용자는 매일 10건의 검색을 수행한다고 가정
- 질의할 떄마다 평균적으로 20바이트의 데이터를 입력한다고 가정
  - 문자 인코딩 방법으로 ASCII를 사용 (1문자=1byte)
  - 질의문은 평균적으로 4개 단어로 이루어진다.(각 단어는 평균적으로 다섯 글자)
  - 질의당 평균 4x5=20 byte
- 검색창에 글자를 입력할 때마다 클라이언트는 검색어 자동완성 백엔드에 요청을 보낸다.
  - 평균적으로 1회 검색당 20건의 요청이 백엔드로 전달
  - 검색창에 dinner라고 입력 시 예시
    ```text
    search?q=d
    search?q=di
    search?q=din
    search?q=dinn
    search?q=dinne
    search?q=dinner
    ```
- 대략 초당 24,000건의 질의(QPS) 발생 (=10,000,000사용자 x 10질의/일 x 20자/24시간/3600초)
- 최대 QPS = QPS x 2 = 대략 48,000
- 질의 가운데 20% 정도는 신규 검색어라고 가정
  - 대략 0.4GB (=10,000,000사용자 x 10질의/일 x 20자 x 20%)

# 2단계: 개략적 설계안

개략적으로 시스템은 두 부분으로 나뉜다.

**데이터 수집 서비스**

- 사용자가 입력한 질의를 실시간으로 수집하는 시스템
- 실시간은 데이터가 많은 애플리케이션에 바람직하지 않지만 설계안의 출발점으로 적합

**질의 서비스**

- 주어진 질의에 다섯 개의 인기 검색어를 정렬해 내놓는 서비스

## 데이터 수집 서비스

질의문과 사용빈도를 저장하는 `빈도 테이블`이 있다고 가정해 보자.

<figure><img src="../../.gitbook/assets/system-design-interview/13-2.png" alt=""><figcaption></figcaption></figure>

## 질의 서비스

<figure><img src="../../.gitbook/assets/system-design-interview/13-1.png" alt=""><figcaption></figcaption></figure>




# 3단계: 상세 설계

# 4단계: 마무리