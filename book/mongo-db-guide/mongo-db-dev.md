# PART II. λ½κ³ DB κ°λ°

# μΈλ±μ‹±

## μΈλ±μ‹± μ†κ°

> μΈλ±μ¤λ¥Ό μ‚¬μ©ν•μ§€ μ•λ” μΏΌλ¦¬λ¥Ό μ»¬λ ‰μ… μ¤μΊ”μ΄λΌ ν•λ©°,
>
> μ„λ²„κ°€ μΏΌλ¦¬ κ²°κ³Όλ¥Ό μ°ΎμΌλ ¤λ©΄ 'μ „μ²΄ λ‚΄μ©μ„ μ‚΄ν΄λ΄μ•Ό ν•¨'μ„ μλ―Έ

1οΈβƒ£ μΈλ±μ¤ μƒμ„±

> μΈλ±μ¤λ¥Ό λ§λ“¤λ ¤λ©΄ `createIndex` μ»¬λ ‰μ… λ©”μ„λ“λ¥Ό μ‚¬μ©

```sql
db.users.createIndex({"username" : 1})
```

- λ‹¤λ¥Έ μ…Έμ—μ„ db.currentOp()λ¥Ό μ‹¤ν–‰ν•κ±°λ‚ mongodμ λ΅κ·Έλ¥Ό ν™•μΈν•΄ μΈλ±μ¤ κµ¬μ¶•μ μ§„ν–‰λ¥  μ²΄ν¬ κ°€λ¥

μΈλ±μ¤λ” μΏΌλ¦¬ μ‹κ°„μ— λ†€λΌμ΄ μ°¨μ΄λ¥Ό λ§λ“ λ‹¤.
- λ‹¨μ μ΄λΌλ©΄, μΈλ±μ‹±λ ν•„λ“λ¥Ό λ³€κ²½ν•λ” μ“°κΈ°(μ‚½μ…, κ°±μ‹ , μ‚­μ ) μ‘μ—…μ€ μ¤λ κ±Έλ¦°λ‹¤.
  - λ°μ΄ν„°κ°€ λ³€κ²½λ  λ•λ§λ‹¤ λ„νλ¨ΌνΈλΏ μ•„λ‹λΌ λ¨λ“  μΈλ±μ¤λ¥Ό κ°±μ‹  ν•„μ”
- μ–΄λ–¤ ν•„λ“κ°€ μΈλ±μ‹±ν•κΈ°μ— μ ν•©ν•μ§€ μ‹ μ¤‘μ΄ νμ•…μ΄ ν•„μ”

{% hint style="info" %}

**λ½κ³ DB μΈλ±μ¤**

μ „ν•μ μΈ κ΄€κ³„ν• λ°μ΄ν„°λ² μ΄μ¤μ μΈλ±μ¤μ™€ κ±°μ λ™μΌν•κ² μ‘λ™

{% endhint %}

μΈλ±μ¤λ¥Ό μƒμ„±ν•  ν•„λ“λ¥Ό μ„ νƒν•λ ¤λ©΄, μμ£Ό μ“°λ” μΏΌλ¦¬μ™€ λΉ¨λ¦¬ μν–‰ν•΄μ•Ό ν•λ” μΏΌλ¦¬λ¥Ό μ΅°μ‚¬ν•΄ κ³µν†µμ μΈ ν‚¤ μ…‹μ„ μ°Ύμ•„λ³΄μ.

.

2οΈβƒ£ λ³µν•© μΈλ±μ¤

> λ‘ κ° μ΄μƒμ ν•„λ“λ΅ κµ¬μ„±λ μΈλ±μ¤
>
> μΏΌλ¦¬μ—μ„ μ •λ ¬ λ°©ν–¥μ΄ μ—¬λ¬ κ°μ΄κ±°λ‚ κ²€μƒ‰ μ΅°κ±΄μ— μ—¬λ¬ κ°μ ν‚¤κ°€ μμ„ λ• μ μ©

λ½κ³ DBκ°€ μ‹¤ν–‰ν•λ” μΏΌλ¦¬ μΆ…λ¥μ— λ”°λΌ μΈλ±μ¤λ¥Ό μ‚¬μ©ν•λ” λ°©λ²•μ΄ λ‹¤λ¥Έλ° κ°€μ¥ λ§μ΄ μ‚¬μ©ν•λ” μ„Έ κ°€μ§€ λ°©λ²•μ„ λ³΄μ.

π‘‰π» **λ‹¨μΌ κ°’μ„ μ°Ύλ” λ™λ“± μΏΌλ¦¬**

```sql
db.users.find({"age": 21}).sort({"username": -1})
```

π‘‰π» **λ²”μ© μΏΌλ¦¬**

```sql
db.users.find({"age": {"$gte": 31, "$lte": 30}})
```

π‘‰π» **μ •λ ¬μ΄ ν¬ν•¨λ λ‹¤μ¤‘κ°’ μΏΌλ¦¬**
- κ²°κ³Όλ¥Ό λ°ν™ν•κΈ° μ „μ— λ©”λ¨λ¦¬μ—μ„ μ •λ ¬ μ‘μ—…μ„ μν–‰ν•μ—¬ μ •λ ¬ μ‹κ°„μ΄ μ†μ”
- μ†λ„λ” κ²€μƒ‰ μ΅°κ±΄κ³Ό μΌμΉν•λ” κ²°κ³Όκ°€ μ–Όλ§λ‚ λ§μ€μ§€μ— λ”°λΌ λ‹¤λ¦„

```sql
db.users.find({"age": {"$gte": 31, "$lte": 30}}).sort({"username": 1})
```

{% hint style="info" %}

λ³µν•© μΈλ±μ¤λ¥Ό κµ¬μ„±ν•  λ•λ” μ •λ ¬ ν‚¤λ¥Ό μ²« λ²μ§Έμ— λ†“μΌλ©΄ μΆ‹λ‹¤.

{% endhint %}

.

4οΈβƒ£ λ³µν•© μΈλ±μ¤ μ‚¬μ©

- μ½κΈ°, μ“°κΈ°λ¥Ό κ°€λ¥ν• ν¨μ¨μ μΌλ΅ μν–‰ν•λ„λ΅ μΈλ±μ¤λ¥Ό μ„¤κ³„ν•μ.
- μΈλ±μ¤μ μ„ νƒμ„±μ„ κ³ λ ¤ν•μ.
- μ»¤μ„ hint λ©”μ„λ“λ¥Ό μ‚¬μ©ν•λ©΄ λ¨μ–‘μ΄λ‚ μ΄λ¦„μ„ μ§€μ •ν•¨μΌλ΅μ¨ μ‚¬μ©ν•  μΈλ±μ¤ μ§€μ • κ°€λ¥
- `planCacheSetFilter` ν•¨μλ¥Ό μΈλ±μ¤ ν•„ν„°μ™€ ν•¨κ» μ‚¬μ©ν•λ©΄, μΏΌλ¦¬ μµν‹°λ§μ΄μ €κ°€ μΈλ±μ¤ ν•„ν„°μ— μ§€μ •λ μΈλ±μ¤λ§ κ³ λ ¤ν•λ„λ΅ μ μ• κ°€λ¥

λ¨λ“  λ°μ΄ν„°μ…‹μ— ν•΄λ‹Ήλμ§€λ” μ•μ§€λ§, μΌλ°μ μΌλ΅ λ™λ“± ν•„ν„°λ¥Ό μ‚¬μ©ν•  ν•„λ“κ°€ λ‹¤μ¤‘κ°’ ν•„ν„°λ¥Ό μ‚¬μ©ν•  ν•„λ“λ³΄λ‹¤ μ•μ— μ¤λ„λ΅ λ³µν•© μΈλ±μ¤λ¥Ό μ„¤κ³„ν•΄μ•Ό ν•λ‹¤.
- λ³µν•© μΈλ±μ¤ μ„¤κ³„ μ‹ μΈλ±μ¤λ¥Ό μ‚¬μ©ν•  κ³µν†µ μΏΌλ¦¬ ν¨ν„΄μ λ™λ“± ν•„ν„°, λ‹¤μ¤‘κ°’ ν•„ν„°, μ •λ ¬ κµ¬μ„± μ”μ†λ¥Ό μ²λ¦¬ν•λ” λ°©λ²•μ„ μ•μ•„μ•Ό ν•λ‹¤.
- μΈλ±μ¤λ¥Ό λ” μ μ„¤κ³„ν•λ©΄ μΈλ©”λ¨λ¦¬ μ •λ ¬μ„ ν”Όν•  μ μλ‹¤.

```sql
db.students.createIndex({class_id:1, student_id:1})
```

{% hint style="info" %}

**λ³µν•© μΈλ±μ¤ μ„¤κ³„ μ‹**

- λ™λ“± ν•„ν„°μ— λ€ν• ν‚¤λ¥Ό λ§¨ μ•μ— ν‘μ‹ν•μ.
- μ •λ ¬μ— μ‚¬μ©λλ” ν‚¤λ” λ‹¤μ¤‘κ°’ ν•„λ“ μ•μ— ν‘μ‹ν•μ.
- λ‹¤μ¤‘κ°’ ν•„ν„°μ— λ€ν• ν‚¤λ” λ§μ§€λ§‰μ— ν‘μ‹ν•μ.

μ§€μΉ¨μ— λ”°λΌ λ³µν•© μΈλ±μ¤ μ„¤κ³„ ν›„, μΈλ±μ¤κ°€ μ§€μ›ν•λ” μΏΌλ¦¬ ν¨ν„΄μ λ²”μ„λ¥Ό μ‹¤μ  μ›ν¬λ΅λ“μ—μ„ ν…μ¤νΈν•μ.

{% endhint %}

**ν‚¤ λ°©ν–¥ μ„ νƒν•κΈ°**

- λ³µν•© μ •λ ¬μ„ μ„λ΅ λ‹¤λ¥Έ λ°©ν–¥μΌλ΅ μµμ ν™”ν•λ ¤λ©΄ λ°©ν–¥μ΄ λ§λ” μΈλ±μ¤λ¥Ό μ‚¬μ©ν•΄μ•Ό ν•λ‹¤.
- μΈλ±μ¤ λ°©ν–¥μ€ λ‹¤μ¤‘ μ΅°κ±΄μ— λ”°λΌ μ •λ ¬ν•  λ•λ§ λ¬Έμ κ°€ λλ‹¤.
- λ‹¨μΌ ν‚¤λ΅ μ •λ ¬ν•λ©΄ λ½κ³ DBλ” μΈλ±μ¤λ¥Ό μ‰½κ² μ—­μμΌλ΅ μ½μ„ μ μλ‹¤.

**μ»¤λ²„νΈ μΏΌλ¦¬ μ‚¬μ©ν•κΈ°**

μΈλ±μ¤κ°€ μΏΌλ¦¬κ°€ μ”κµ¬ν•λ” κ°’μ„ λ¨λ‘ ν¬ν•¨ν•λ©΄, μΏΌλ¦¬κ°€ μ»¤λ²„λ“ λλ‹¤κ³  ν•λ‹¤.
- μ‹¤λ¬΄μ—μ„λ” λ„νλ¨ΌνΈλ΅ λ°›μ§€ λ§κ³  ν•­μƒ μ»¤λ²„λ“ μΏΌλ¦¬(covered query)λ¥Ό μ‚¬μ©ν•μ.
- μ΄ λ°©λ²•μΌλ΅ μ‘μ—… μ…‹μ„ ν›¨μ”¬ μ‘κ² λ§λ“¤ μ μλ‹¤.
- μΏΌλ¦¬κ°€ ν™•μ‹¤ν μΈλ±μ¤λ§ μ‚¬μ©ν•κ² ν•λ ¤λ©΄ "_id" ν•„λ“λ¥Ό λ°ν™λ°›μ§€ μ•λ„λ΅ λ°ν™λ°›μ„ ν‚¤λ¥Ό μ§€μ •ν•΄μ•Ό ν•λ‹¤.

**μ•”μ‹μ  μΈλ±μ¤**

- μ—¬λ¬ ν‚¤μ— ν•„μ”ν• λ§νΌ μ μ© κ°€λ¥
- μΈλ±μ¤κ°€ N κ°μ ν‚¤λ¥Ό κ°€μ§„λ‹¤λ©΄ ν‚¤λ“¤μ μ•λ¶€λ¶„μ€ 'κ³µμ§'μΈλ±μ¤κ°€ λλ‹¤.

```json
// μ•„λ μΈλ±μ¤κ°€ μλ‹¤λ©΄ 
{"a" : 1, "b" : 1, "c" : 1, ... "z" : 1 } 
// κ³µμ§ μΈλ±μ¤λ¥Ό κ°€μ§
{"a" : 1}, {"a" : 1, "b" : 1 }, {"a" : 1, "b" : 1, "c" : 1 }  ...
```

. 

5οΈβƒ£ $ μ—°μ‚°μμ μΈλ±μ¤ μ‚¬μ©λ²•

**λΉ„ν¨μ¨μ μΈ μ—°μ‚°μ**

- μΌλ°μ μΌλ΅ λ¶€μ • μ΅°κ±΄μ€ λΉ„ν¨μ¨μ 
- "`$ne`" μΏΌλ¦¬λ” μΈλ±μ¤λ¥Ό μ‚¬μ©ν•κΈ΄ ν•μ§€λ§ μ ν™μ©ν•μ§€ λ» ν•λ‹¤.

**λ²”μ„**

- λ³µν•© μΈλ±μ¤λ” λ½κ³ DBκ°€ λ‹¤μ¤‘ μ  μΏΌλ¦¬λ¥Ό λ” ν¨μ¨μ μΌλ΅ μ‹¤ν–‰ν•λ„λ΅ λ•λ”λ‹¤.

**OR μΏΌλ¦¬**

- ν„μ¬ λ½κ³ DBλ” μΏΌλ¦¬λ‹Ή ν•λ‚μ μΈλ±μ¤λ§ μ‚¬μ© κ°€λ¥
- μ μΌν• μμ™Έλ” "`$or`"
  - "`$or`"λ” λ‘ κ°μ μΏΌλ¦¬λ¥Ό μν–‰ν•κ³  κ²°κ³Όλ¥Ό ν•©μΉλ―€λ΅ "`$or`"μ€ "`$or`"μ λ§λ‹¤ ν•λ‚μ”© μΈλ±μ¤ μ‚¬μ©
- κ°€λ¥ν•λ©΄ "`$or`"λ³΄λ‹¤λ” "`$in`"μ„ μ‚¬μ©ν•μ.
  - μΌλ°μ μΌλ΅ λ‘ λ² μΏΌλ¦¬ν•΄μ„ κ²°κ³Όλ¥Ό λ³‘ν•©ν•λ©΄ ν• λ² μΏΌλ¦¬ν•  λ•λ³΄λ‹¤ ν›¨μ”¬ λΉ„ν¨μ¨μ 
  - "`$or`"λ¥Ό μ‚¬μ©ν•΄μ•Ό ν•λ‹¤λ©΄ λ½κ³ DBκ°€ λ‘ μΏΌλ¦¬μ κ²°κ³Όλ¥Ό μ΅°μ‚¬ν•κ³  μ¤‘λ³µμ„ λ¨λ‘ μ κ±°ν•΄μ•Ό ν•λ‹¤.

## explain μ¶λ ¥

## μΈλ±μ¤λ¥Ό μƒμ„±ν•μ§€ μ•λ” μ΄μ 

## μΈλ±μ¤ μΆ…λ¥

## μΈλ±μ¤ κ΄€λ¦¬

# νΉμ μΈλ±μ¤μ™€ μ»¬λ ‰μ… μ ν•

## κ³µκ°„ μ •λ³΄ μΈλ±μ¤

## μ „λ¬Έ κ²€μƒ‰μ„ μ„ν• μΈλ±μ¤

## μ ν• μ»¬λ ‰μ…

## TTL μΈλ±μ¤

## GridFSλ΅ νμΌ μ €μ¥ν•κΈ°

# μ§‘κ³„ ν”„λ΅μ„μ›ν¬

# νΈλμ­μ…

# μ• ν”λ¦¬μΌ€μ΄μ… μ„¤κ³„