# PART II. ëª½ê³ DB ê°œë°œ

# ì¸ë±ì‹±

## ì¸ë±ì‹± ì†Œê°œ

> ì¸ë±ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ì¿¼ë¦¬ë¥¼ ì»¬ë ‰ì…˜ ìŠ¤ìº”ì´ë¼ í•˜ë©°,
>
> ì„œë²„ê°€ ì¿¼ë¦¬ ê²°ê³¼ë¥¼ ì°¾ìœ¼ë ¤ë©´ 'ì „ì²´ ë‚´ìš©ì„ ì‚´í´ë´ì•¼ í•¨'ì„ ì˜ë¯¸

1ï¸âƒ£ ì¸ë±ìŠ¤ ìƒì„±

> ì¸ë±ìŠ¤ë¥¼ ë§Œë“¤ë ¤ë©´ `createIndex` ì»¬ë ‰ì…˜ ë©”ì„œë“œë¥¼ ì‚¬ìš©

```sql
db.users.createIndex({"username" : 1})
```

- ë‹¤ë¥¸ ì…¸ì—ì„œ db.currentOp()ë¥¼ ì‹¤í–‰í•˜ê±°ë‚˜ mongodì˜ ë¡œê·¸ë¥¼ í™•ì¸í•´ ì¸ë±ìŠ¤ êµ¬ì¶•ì˜ ì§„í–‰ë¥  ì²´í¬ ê°€ëŠ¥

ì¸ë±ìŠ¤ëŠ” ì¿¼ë¦¬ ì‹œê°„ì— ë†€ë¼ìš´ ì°¨ì´ë¥¼ ë§Œë“ ë‹¤.
- ë‹¨ì ì´ë¼ë©´, ì¸ë±ì‹±ëœ í•„ë“œë¥¼ ë³€ê²½í•˜ëŠ” ì“°ê¸°(ì‚½ì…, ê°±ì‹ , ì‚­ì œ) ì‘ì—…ì€ ì˜¤ë˜ ê±¸ë¦°ë‹¤.
  - ë°ì´í„°ê°€ ë³€ê²½ë  ë•Œë§ˆë‹¤ ë„íë¨¼íŠ¸ë¿ ì•„ë‹ˆë¼ ëª¨ë“  ì¸ë±ìŠ¤ë¥¼ ê°±ì‹  í•„ìš”
- ì–´ë–¤ í•„ë“œê°€ ì¸ë±ì‹±í•˜ê¸°ì— ì í•©í•œì§€ ì‹ ì¤‘ì´ íŒŒì•…ì´ í•„ìš”

{% hint style="info" %}

**ëª½ê³ DB ì¸ë±ìŠ¤**

ì „í˜•ì ì¸ ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ì˜ ì¸ë±ìŠ¤ì™€ ê±°ì˜ ë™ì¼í•˜ê²Œ ì‘ë™

{% endhint %}

ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•  í•„ë“œë¥¼ ì„ íƒí•˜ë ¤ë©´, ìì£¼ ì“°ëŠ” ì¿¼ë¦¬ì™€ ë¹¨ë¦¬ ìˆ˜í–‰í•´ì•¼ í•˜ëŠ” ì¿¼ë¦¬ë¥¼ ì¡°ì‚¬í•´ ê³µí†µì ì¸ í‚¤ ì…‹ì„ ì°¾ì•„ë³´ì.

.

2ï¸âƒ£ ë³µí•© ì¸ë±ìŠ¤

> ë‘ ê°œ ì´ìƒì˜ í•„ë“œë¡œ êµ¬ì„±ëœ ì¸ë±ìŠ¤
>
> ì¿¼ë¦¬ì—ì„œ ì •ë ¬ ë°©í–¥ì´ ì—¬ëŸ¬ ê°œì´ê±°ë‚˜ ê²€ìƒ‰ ì¡°ê±´ì— ì—¬ëŸ¬ ê°œì˜ í‚¤ê°€ ìˆì„ ë•Œ ìœ ìš©

ëª½ê³ DBê°€ ì‹¤í–‰í•˜ëŠ” ì¿¼ë¦¬ ì¢…ë¥˜ì— ë”°ë¼ ì¸ë±ìŠ¤ë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì´ ë‹¤ë¥¸ë° ê°€ì¥ ë§ì´ ì‚¬ìš©í•˜ëŠ” ì„¸ ê°€ì§€ ë°©ë²•ì„ ë³´ì.

ğŸ‘‰ğŸ» **ë‹¨ì¼ ê°’ì„ ì°¾ëŠ” ë™ë“± ì¿¼ë¦¬**

```sql
db.users.find({"age": 21}).sort({"username": -1})
```

ğŸ‘‰ğŸ» **ë²”ìš© ì¿¼ë¦¬**

```sql
db.users.find({"age": {"$gte": 31, "$lte": 30}})
```

ğŸ‘‰ğŸ» **ì •ë ¬ì´ í¬í•¨ëœ ë‹¤ì¤‘ê°’ ì¿¼ë¦¬**
- ê²°ê³¼ë¥¼ ë°˜í™˜í•˜ê¸° ì „ì— ë©”ëª¨ë¦¬ì—ì„œ ì •ë ¬ ì‘ì—…ì„ ìˆ˜í–‰í•˜ì—¬ ì •ë ¬ ì‹œê°„ì´ ì†Œìš”
- ì†ë„ëŠ” ê²€ìƒ‰ ì¡°ê±´ê³¼ ì¼ì¹˜í•˜ëŠ” ê²°ê³¼ê°€ ì–¼ë§ˆë‚˜ ë§ì€ì§€ì— ë”°ë¼ ë‹¤ë¦„

```sql
db.users.find({"age": {"$gte": 31, "$lte": 30}}).sort({"username": 1})
```

{% hint style="info" %}

ë³µí•© ì¸ë±ìŠ¤ë¥¼ êµ¬ì„±í•  ë•ŒëŠ” ì •ë ¬ í‚¤ë¥¼ ì²« ë²ˆì§¸ì— ë†“ìœ¼ë©´ ì¢‹ë‹¤.

{% endhint %}

.

4ï¸âƒ£ ë³µí•© ì¸ë±ìŠ¤ ì‚¬ìš©

- ì½ê¸°, ì“°ê¸°ë¥¼ ê°€ëŠ¥í•œ íš¨ìœ¨ì ìœ¼ë¡œ ìˆ˜í–‰í•˜ë„ë¡ ì¸ë±ìŠ¤ë¥¼ ì„¤ê³„í•˜ì.
- ì¸ë±ìŠ¤ì˜ ì„ íƒì„±ì„ ê³ ë ¤í•˜ì.
- ì»¤ì„œ hint ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ë©´ ëª¨ì–‘ì´ë‚˜ ì´ë¦„ì„ ì§€ì •í•¨ìœ¼ë¡œì¨ ì‚¬ìš©í•  ì¸ë±ìŠ¤ ì§€ì • ê°€ëŠ¥
- `planCacheSetFilter` í•¨ìˆ˜ë¥¼ ì¸ë±ìŠ¤ í•„í„°ì™€ í•¨ê»˜ ì‚¬ìš©í•˜ë©´, ì¿¼ë¦¬ ì˜µí‹°ë§ˆì´ì €ê°€ ì¸ë±ìŠ¤ í•„í„°ì— ì§€ì •ëœ ì¸ë±ìŠ¤ë§Œ ê³ ë ¤í•˜ë„ë¡ ì œì•ˆ ê°€ëŠ¥

ëª¨ë“  ë°ì´í„°ì…‹ì— í•´ë‹¹ë˜ì§€ëŠ” ì•Šì§€ë§Œ, ì¼ë°˜ì ìœ¼ë¡œ ë™ë“± í•„í„°ë¥¼ ì‚¬ìš©í•  í•„ë“œê°€ ë‹¤ì¤‘ê°’ í•„í„°ë¥¼ ì‚¬ìš©í•  í•„ë“œë³´ë‹¤ ì•ì— ì˜¤ë„ë¡ ë³µí•© ì¸ë±ìŠ¤ë¥¼ ì„¤ê³„í•´ì•¼ í•œë‹¤.
- ë³µí•© ì¸ë±ìŠ¤ ì„¤ê³„ ì‹œ ì¸ë±ìŠ¤ë¥¼ ì‚¬ìš©í•  ê³µí†µ ì¿¼ë¦¬ íŒ¨í„´ì˜ ë™ë“± í•„í„°, ë‹¤ì¤‘ê°’ í•„í„°, ì •ë ¬ êµ¬ì„± ìš”ì†Œë¥¼ ì²˜ë¦¬í•˜ëŠ” ë°©ë²•ì„ ì•Œì•„ì•¼ í•œë‹¤.
- ì¸ë±ìŠ¤ë¥¼ ë” ì˜ ì„¤ê³„í•˜ë©´ ì¸ë©”ëª¨ë¦¬ ì •ë ¬ì„ í”¼í•  ìˆ˜ ìˆë‹¤.

```sql
db.students.createIndex({class_id:1, student_id:1})
```

{% hint style="info" %}

**ë³µí•© ì¸ë±ìŠ¤ ì„¤ê³„ ì‹œ**

- ë™ë“± í•„í„°ì— ëŒ€í•œ í‚¤ë¥¼ ë§¨ ì•ì— í‘œì‹œí•˜ì.
- ì •ë ¬ì— ì‚¬ìš©ë˜ëŠ” í‚¤ëŠ” ë‹¤ì¤‘ê°’ í•„ë“œ ì•ì— í‘œì‹œí•˜ì.
- ë‹¤ì¤‘ê°’ í•„í„°ì— ëŒ€í•œ í‚¤ëŠ” ë§ˆì§€ë§‰ì— í‘œì‹œí•˜ì.

ì§€ì¹¨ì— ë”°ë¼ ë³µí•© ì¸ë±ìŠ¤ ì„¤ê³„ í›„, ì¸ë±ìŠ¤ê°€ ì§€ì›í•˜ëŠ” ì¿¼ë¦¬ íŒ¨í„´ì˜ ë²”ìœ„ë¥¼ ì‹¤ì œ ì›Œí¬ë¡œë“œì—ì„œ í…ŒìŠ¤íŠ¸í•˜ì.

{% endhint %}

**í‚¤ ë°©í–¥ ì„ íƒí•˜ê¸°**

- ë³µí•© ì •ë ¬ì„ ì„œë¡œ ë‹¤ë¥¸ ë°©í–¥ìœ¼ë¡œ ìµœì í™”í•˜ë ¤ë©´ ë°©í–¥ì´ ë§ëŠ” ì¸ë±ìŠ¤ë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤.
- ì¸ë±ìŠ¤ ë°©í–¥ì€ ë‹¤ì¤‘ ì¡°ê±´ì— ë”°ë¼ ì •ë ¬í•  ë•Œë§Œ ë¬¸ì œê°€ ëœë‹¤.
- ë‹¨ì¼ í‚¤ë¡œ ì •ë ¬í•˜ë©´ ëª½ê³ DBëŠ” ì¸ë±ìŠ¤ë¥¼ ì‰½ê²Œ ì—­ìˆœìœ¼ë¡œ ì½ì„ ìˆ˜ ìˆë‹¤.

**ì»¤ë²„íŠ¸ ì¿¼ë¦¬ ì‚¬ìš©í•˜ê¸°**

ì¸ë±ìŠ¤ê°€ ì¿¼ë¦¬ê°€ ìš”êµ¬í•˜ëŠ” ê°’ì„ ëª¨ë‘ í¬í•¨í•˜ë©´, ì¿¼ë¦¬ê°€ ì»¤ë²„ë“œ ëœë‹¤ê³  í•œë‹¤.
- ì‹¤ë¬´ì—ì„œëŠ” ë„íë¨¼íŠ¸ë¡œ ë°›ì§€ ë§ê³  í•­ìƒ ì»¤ë²„ë“œ ì¿¼ë¦¬(covered query)ë¥¼ ì‚¬ìš©í•˜ì.
- ì´ ë°©ë²•ìœ¼ë¡œ ì‘ì—… ì…‹ì„ í›¨ì”¬ ì‘ê²Œ ë§Œë“¤ ìˆ˜ ìˆë‹¤.
- ì¿¼ë¦¬ê°€ í™•ì‹¤íˆ ì¸ë±ìŠ¤ë§Œ ì‚¬ìš©í•˜ê²Œ í•˜ë ¤ë©´ "_id" í•„ë“œë¥¼ ë°˜í™˜ë°›ì§€ ì•Šë„ë¡ ë°˜í™˜ë°›ì„ í‚¤ë¥¼ ì§€ì •í•´ì•¼ í•œë‹¤.

**ì•”ì‹œì  ì¸ë±ìŠ¤**

- ì—¬ëŸ¬ í‚¤ì— í•„ìš”í•œ ë§Œí¼ ì ìš© ê°€ëŠ¥
- ì¸ë±ìŠ¤ê°€ N ê°œì˜ í‚¤ë¥¼ ê°€ì§„ë‹¤ë©´ í‚¤ë“¤ì˜ ì•ë¶€ë¶„ì€ 'ê³µì§œ'ì¸ë±ìŠ¤ê°€ ëœë‹¤.

```json
// ì•„ë˜ ì¸ë±ìŠ¤ê°€ ìˆë‹¤ë©´ 
{"a" : 1, "b" : 1, "c" : 1, ... "z" : 1 } 
// ê³µì§œ ì¸ë±ìŠ¤ë¥¼ ê°€ì§
{"a" : 1}, {"a" : 1, "b" : 1 }, {"a" : 1, "b" : 1, "c" : 1 }  ...
```

. 

5ï¸âƒ£ $ ì—°ì‚°ìì˜ ì¸ë±ìŠ¤ ì‚¬ìš©ë²•

**ë¹„íš¨ìœ¨ì ì¸ ì—°ì‚°ì**

- ì¼ë°˜ì ìœ¼ë¡œ ë¶€ì • ì¡°ê±´ì€ ë¹„íš¨ìœ¨ì 
- "`$ne`" ì¿¼ë¦¬ëŠ” ì¸ë±ìŠ¤ë¥¼ ì‚¬ìš©í•˜ê¸´ í•˜ì§€ë§Œ ì˜ í™œìš©í•˜ì§€ ëª» í•œë‹¤.

**ë²”ìœ„**

- ë³µí•© ì¸ë±ìŠ¤ëŠ” ëª½ê³ DBê°€ ë‹¤ì¤‘ ì ˆ ì¿¼ë¦¬ë¥¼ ë” íš¨ìœ¨ì ìœ¼ë¡œ ì‹¤í–‰í•˜ë„ë¡ ë•ëŠ”ë‹¤.

**OR ì¿¼ë¦¬**

- í˜„ì¬ ëª½ê³ DBëŠ” ì¿¼ë¦¬ë‹¹ í•˜ë‚˜ì˜ ì¸ë±ìŠ¤ë§Œ ì‚¬ìš© ê°€ëŠ¥
- ìœ ì¼í•œ ì˜ˆì™¸ëŠ” "`$or`"
  - "`$or`"ëŠ” ë‘ ê°œì˜ ì¿¼ë¦¬ë¥¼ ìˆ˜í–‰í•˜ê³  ê²°ê³¼ë¥¼ í•©ì¹˜ë¯€ë¡œ "`$or`"ì€ "`$or`"ì ˆë§ˆë‹¤ í•˜ë‚˜ì”© ì¸ë±ìŠ¤ ì‚¬ìš©
- ê°€ëŠ¥í•˜ë©´ "`$or`"ë³´ë‹¤ëŠ” "`$in`"ì„ ì‚¬ìš©í•˜ì.
  - ì¼ë°˜ì ìœ¼ë¡œ ë‘ ë²ˆ ì¿¼ë¦¬í•´ì„œ ê²°ê³¼ë¥¼ ë³‘í•©í•˜ë©´ í•œ ë²ˆ ì¿¼ë¦¬í•  ë•Œë³´ë‹¤ í›¨ì”¬ ë¹„íš¨ìœ¨ì 
  - "`$or`"ë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤ë©´ ëª½ê³ DBê°€ ë‘ ì¿¼ë¦¬ì˜ ê²°ê³¼ë¥¼ ì¡°ì‚¬í•˜ê³  ì¤‘ë³µì„ ëª¨ë‘ ì œê±°í•´ì•¼ í•œë‹¤.

.

6ï¸âƒ£ ê°ì²´ ë° ë°°ì—´ ì¸ë±ì‹±

**ë‚´ì¥ ë„íë¨¼íŠ¸ ì¸ë±ì‹±í•˜ê¸°**

- ì¸ë±ìŠ¤ëŠ” ì¼ë°˜ì ì¸ í‚¤ì— ìƒì„±ë  ë–„ì™€ ë™ì¼í•œ ë°©ì‹ìœ¼ë¡œ ë‚´ì¥ ë„íë¨¼íŠ¸ì— í‚¤ ìƒì„± ê°€ëŠ¥
- ì„œë¸Œ í•„ë“œì— ì¸ë±ìŠ¤ë¥¼ ë§Œë“¤ì–´ í•´ë‹¹ í•„ë“œë¥¼ ì´ìš©í•˜ëŠ” ì¿¼ë¦¬ì˜ ì†ë„ë¥¼ ë†’ì¼ ìˆ˜ ìˆë‹¤.
- ì„œë¸Œ ë„íë¨¼íŠ¸ ì „ì²´ë¥¼ ì¸ë±ì‹±í•˜ë©´ ì„œë¸Œ ë„íë¨¼íŠ¸ ì „ì²´ì— ì¿¼ë¦¬í•  ë•Œë§Œ ë„ì›€ì´ ëœë‹¤.

```sql
db.users.createIndex({"loc.city" : 1})
```

**ë°°ì—´ ì¸ë±ì‹±í•˜ê¸°**

- ë°°ì—´ì—ë„ ì¸ë±ìŠ¤ ìƒì„± ê°€ëŠ¥
- ì¸ë±ìŠ¤ë¥¼ ì‚¬ìš©í•˜ë©´ ë°°ì—´ì˜ íŠ¹ì • ìš”ì†Œë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ íƒìƒ‰
- ë‹¨, ë‚´ì¥ ë„íë¨¼íŠ¸ì™€ ë‹¬ë¦¬ ë°°ì—´ ì „ì²´ë¥¼ ë‹¨ì¼ ê°œì²´ì²˜ëŸ¼ ì¸ë±ì‹± ë¶ˆê°€
  - ë°°ì—´ í•„ë“œ ì¸ë±ì‹±ì€ ë°°ì—´ ìì²´ê°€ ì•„ë‹ˆë¼ ë°°ì—´ì˜ ê° ìš”ì†Œë¥¼ ì¸ë…ì‹±í•˜ê¸° ë•Œë¬¸

```sql
db.blog.createIndex({"comments.date" : 1})
```

**ë‹¤ì¤‘í‚¤ ì¸ë±ìŠ¤ê°€ ë¯¸ì¹˜ëŠ” ì˜í–¥**

- ì–´ë–¤ ë„íë¨¼íŠ¸ê°€ ë°°ì—´ í•„ë“œë¥¼ ì¸ë±ìŠ¤ í‚¤ë¡œ ê°€ì§€ë©´ ì¸ë±ìŠ¤ëŠ” ì¦‰ì‹œ ë‹¤ì¤‘í‚¤ ì¸ë±ìŠ¤ë¡œ í‘œì‹œ
- ë‹¤ì¤‘í‚¤ ì¸ë±ìŠ¤ëŠ” ë¹„ë‹¤ì¤‘í‚¤ ì¸ë±ìŠ¤ë³´ë‹¤ ì•½ê°„ ëŠë¦´ ìˆ˜ ìˆìŒ
  - í•˜ë‚˜ì˜ ë„íë¨¼íŠ¸ë¥¼ ì—¬ëŸ¬ ê°œì˜ ì¸ë±ìŠ¤ í•­ëª©ì´ ê°€ë¦¬í‚¬ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ëª½ê³ DBëŠ” ê²°ê³¼ ë°˜í™˜ ì „ ì¤‘ë³µì„ ì œê±°

.

7ï¸âƒ£ ì¸ë±ìŠ¤ ì¹´ë””ë„ë¦¬í‹°

- ì¹´ë””ë„ë¦¬í‹°(cardinality)ëŠ” ì»¬ë ‰ì…˜ì˜ í•œ í•„ë“œì— ëŒ€í•´ ê³ ìœ³ê°’ì´ ì–¼ë§ˆë‚˜ ë§ì€ì§€ë¥¼ ë‚˜íƒ€ëƒ„
- "username", "email" ê°™ì€ í•„ë“œëŠ” ì»¬ë ‰ì…˜ì˜ ê° ë„íë¨¼íŠ¸ë§ˆë‹¤ ìœ ì¼í•œ ê°’ì„ ê°€ì§€ë©°, ì´ëŠ” ë†’ì€ ì¹´ë””ë„ë¦¬í‹°
- ì¼ë°˜ì ìœ¼ë¡œ í•„ë“œì˜ ì¹´ë””ë„ë¦¬í‹°ê°€ ë†’ì„ìˆ˜ë¡ ì¸ë±ì‹±ì´ ë”ìš± ë„ì›€
- ì ì–´ë„ ë³µí•© ì¸ë±ìŠ¤ì—ì„œ ë†’ì€ ì¹´ë””ë„ë¦¬í‹° í‚¤ë¥¼ ë‚®ì€ ì¹´ë””ë„ë¦¬í‹° í‚¤ ì•ì— ë†“ì.

## explain ì¶œë ¥

> explainì€ ì¿¼ë¦¬ì— ëŒ€í•œ ë§ì€ ì •ë³´ë¥¼ ì œê³µí•˜ë©°, ëŠë¦° ì¿¼ë¦¬ë¥¼ ìœ„í•œ ì¤‘ìš”í•œ ì§„ë‹¨ ë„êµ¬
>
> ì¿¼ì˜ explain ì¶œë ¥ì„ ë³´ë©´ ì–´ë–¤ ì¸ë±ìŠ¤ê°€ ì–´ë–»ê²Œ ì‚¬ìš©ë˜ëŠ”ì§€ ì•Œ ìˆ˜ ìˆë‹¤.

ì¿¼ë¦¬ê°€ "COLLSCAN"ì„ ì‚¬ìš©í•˜ë©´ ì¸ë±ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠìŒì„ ì•Œ ìˆ˜ ìˆë‹¤.

```sql
db.users.find({"age" : 42}).explain('executionStats')
```

- "totalKeysExamined"ëŠ” ê²€ìƒ‰í•œ ì¸ë±ìŠ¤ í•­ëª© ê°œìˆ˜
- ìŠ¤ìº”í•œ ë„íë¨¼íŠ¸ ê°œìˆ˜ "nscannedObjects"
- "executionTimeMillis"ëŠ” ì„œë²„ê°€ ìš”ì²­ì„ ë°›ê³  ì‘ë‹µì„ ë³´ë‚¸ ì‹œì ê¹Œì§€ ì¿¼ë¦¬ê°€ ì–¼ë§ˆë‚˜ ë¹¨ë¦¬ ì‹¤í–‰ëëŠ”ì§€

ì¤‘ìš”í•œ í•„ë“œ
- `isMultiKey` : ë‹¤ì¤‘í‚¤ ì¸ë±ìŠ¤ ì‚¬ìš© ì—¬ë¶€(true/false)
- `nReturned` : ì¿¼ë¦¬ì— ì˜í•´ ë°˜í™˜ëœ ë„íë¨¼íŠ¸ ê°œìˆ˜
- `totalDocsExamined` : ëª½ê³ DBê°€ ë””ìŠ¤í¬ ë‚´ ì‹¤ì œ ë„íë¨¼íŠ¸ë¥¼ ê°€ë¦¬í‚¤ëŠ” ì¸ë±ìŠ¤ í¬ì¸í„°ë¥¼ ë”°ë¼ê°„ íšŸìˆ˜
- `totalKeysExamine` : ì¸ë±ìŠ¤ê°€ ì‚¬ìš©ë˜ì—ˆë‹¤ë©´ ì‚´í´ë³¸ ì¸ë±ìŠ¤ í•­ëª© ê°œìˆ˜
- `stage` : ëª½ê³ DBê°€ ì¸ë±ìŠ¤ë¥¼ ì‚¬ìš©í•´ ì¿¼ë¦¬í•  ìˆ˜ ìˆì—ˆëŠ”ì§€ ì—¬ë¶€
  - "COLSCAN": ì»¬ë ‰ì…˜ ìŠ¤ìº”
  - "IXSCAN": ì¸ë±ìŠ¤ ìŠ¤ìº”
- `needYields` : ì“°ê¸° ìš”ì²­ì„ ì²˜ë¦¬í•˜ë„ë¡ ì¿¼ë¦¬ê°€ ì–‘ë³´í•œ íšŸìˆ˜
- `executionTimeMillis` : DBê°€ ì¿¼ë¦¬í•˜ëŠ” ë° ê±¸ë¦° ì‹œê°„
- `indexBounds` : ì¸ë±ìŠ¤ê°€ ì–´ë–»ê²Œ ì‚¬ìš©ëëŠ”ì§€ ì„¤ëª…í•˜ë©° íƒìƒ‰í•œ ì¸ë±ìŠ¤ì˜ ë²”ìœ„ë¥¼ ì œê³µ

## ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•˜ì§€ ì•ŠëŠ” ì´ìœ 

> ì¸ë±ìŠ¤ëŠ” ë°ì´í„°ì˜ ì¼ë¶€ë¥¼ ì¡°íšŒí•  ë•Œ ê°€ì¥ íš¨ìœ¨ì ì´ë©° ì–´ë–¤ ì¿¼ë¦¬ëŠ” ì¸ë±ìŠ¤ê°€ ì—†ëŠ” ê²Œ ë” ë¹ ë¥´ë‹¤

ì¸ë±ìŠ¤ëŠ” ì»¬ë ‰ì…˜ì—ì„œ ê°€ì ¸ì™€ì•¼ í•˜ëŠ” ë¶€ë¶„ì´ ë§ì„ìˆ˜ë¡ ë¹„íš¨ìœ¨ì ì¸ë°, ì¸ë±ìŠ¤ë¥¼ í•˜ë‚˜ ì‚¬ìš©í•˜ë ¤ë©´ ë‘ ë²ˆì˜ ì¡°íšŒë¥¼ í•´ì•¼ í•˜ê¸° ë•Œë¬¸
- í•œ ë²ˆì€ ì¸ë±ìŠ¤ í•­ëª©ì„ ì‚´í´ë³´ê³ , ë˜ í•œ ë²ˆì€ ë„íë¨¼íŠ¸ë¥¼ ê°€ë¦¬í‚¤ëŠ” ì¸ë±ìŠ¤ì˜ í¬ì¸í„°ë¥¼ ë”°ë¼ê°„ë‹¤
- ë°˜ë©´, ì»¬ë ‰ì…˜ ìŠ¤ìº” ì‹œì—ëŠ” ë„íë¨¼íŠ¸ë§Œ ì‚´í´ë³´ë©´ ëœë‹¤.
- ìµœì•…ì˜ ê²½ìš°(ì»¬ë ‰ì…˜ì˜ ëª¨ë“  ë„íë¨¼íŠ¸ë¥¼ ë°˜í™˜í•´ì•¼ í•  ê²½ìš°) ì¸ë±ìŠ¤ë¥¼ ì‚¬ìš©í•˜ë©´ ë‘ ë°°ë‚˜ ë§ì€ ì¡°íšŒë¥¼ ìˆ˜í–‰í•˜ë©° ì»¬ë ‰ì…˜ ìŠ¤ìº”ë³´ë‹¤ í›¨ì”¬ ëŠë¦¬ë‹¤.

## ì¸ë±ìŠ¤ ì¢…ë¥˜

**ê³ ìœ  ì¸ë±ìŠ¤**

- ê³ ìœ  ì¸ë±ìŠ¤ëŠ” ê° ê°’ì´ ì¸ë±ìŠ¤ì— ìµœëŒ€ í•œ ë²ˆ ë‚˜íƒ€ë‚˜ë„ë¡ ë³´ì¥

**ë¶€ë¶„ ì¸ë±ìŠ¤**

- ë¶€ë¶„ ì¸ë±ìŠ¤ë¥¼ ë§Œë“¤ë ¤ë©´ "partialFilterExpression" ì˜µì…˜ì„ í¬í•¨

## ì¸ë±ìŠ¤ ê´€ë¦¬

ë°ì´í„°ë² ì´ìŠ¤ì˜ ì¸ë±ìŠ¤ ì •ë³´ëŠ” ëª¨ë‘ `system.indexes` ì»¬ë ‰ì…˜ì— ì €ì¥
- íŠ¹ì • ì»¬ë ‰ì…˜ì˜ ëª¨ë“  ì¸ë±ìŠ¤ ì •ë³´ë¥¼ í™•ì¸í•˜ë ¤ë©´ `db.c.getIndexes()`ë¥¼ ì‹¤í–‰

```sql
db.studnts.getIndexes()
```

- "key"ëŠ” íŒíŠ¸ì— ì‚¬ìš©í•˜ê±°ë‚˜, ì¸ë±ìŠ¤ê°€ ëª…ì‹œë¼ì•¼ í•˜ëŠ” ìœ„ì¹˜ì— ì‚¬ìš©í•  ìˆ˜ ìˆìŒ
- ì¸ë±ìŠ¤ëª…("name")ì€ dropIndexesì™€ ê°™ì€ ê´€ë¦¬ì ì¸ ì¸ë±ìŠ¤ ì‘ì—…ì—ì„œ ì‹ë³„ìë¡œ ì‚¬ìš©

**ì¸ë±ìŠ¤ ì‹ë³„**

- ì¸ë±ìŠ¤ëª…ì€ ê¸°ë³¸ì ìœ¼ë¡œ `í‚¤ëª…1_ë°©í–¥1_í‚¤ëª…2_ë°©í–¥_..._í‚¤ëª…N_ë°©í–¥N`
- `getLastError` í˜¸ì¶œì€ ì¸ë±ìŠ¤ ìƒì„±ì˜ ì„±ê³µ ì—¬ë¶€ í˜¹ì€ ì‹¤íŒ¨ ì›ì¸ì„ ë³´ì—¬ì¤€ë‹¤.

# ì§‘ê³„ í”„ë ˆì„ì›Œí¬

## íŒŒì´í”„ë¼ì¸

> ì§‘ê³„ í”„ë ˆì„ì›Œí¬ëŠ” íŒŒì´í”„ë¼ì¸ ê°œë…ì„ ê¸°ë°˜ìœ¼ë¡œ í•œë‹¤.

íŒŒì´í”„ë¼ì¸ì€ ëª½ê³ DB ì»¬ë ‰ì…˜ê³¼ í•¨ê»˜ ì‘ë™
- íŒŒì´íŠ¸ë¼ì¸ì€ ë‹¨ê³„ë¡œ êµ¬ì„±ë˜ë©° ê° ë‹¨ê³„ëŠ” ì…ë ¥ì— ì„œë¡œ ë‹¤ë¥¸ ë°ì´í„° ì²˜ë¦¬ ì‘ì—…ì„ ìˆ˜í–‰í•˜ê³ 
- ì¶œë ¥ìœ¼ë¡œ ë„íë¨¼íŠ¸ë¥¼ ìƒì„±í•´ ë‹¤ìŒ ë‹¨ê³„ë¡œ ì „ë‹¬

## ë‹¨ê³„ ì‹œì‘

`aggregate`ëŠ” ì§‘ê³„ ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•  ë•Œ í˜¸ì¶œí•˜ëŠ” ë©”ì„œë“œ
- "_id" í•„ë“œëŠ” ì œì™¸í•˜ê³  "name"ê³¼ "founded_year"ëŠ” í¬í•¨
- **í•„í„°ë§ì„ ìœ„í•œ ì¼ì¹˜ ë‹¨ê³„**ì™€ **ì¶œë ¥ì„ ë„íë¨¼íŠ¸ë‹¹ ë‘ ê°œì˜ í•„ë“œë¡œ ì œí•œí•˜ëŠ” ì„ ì¶œ ë‹¨ê³„**ê°€ ì¡´ì¬

```sql
db.companies.aggregate([
    {$match: {founded_year: 2004}},
    {
        $project: {
            _id: 0,
            name: 1,
            founded_year: 1
        }
    }
])
```

**5ë‹¨ê³„ì˜ íŒŒì´í”„ë¼ì¸**
- ì œí•œì„ ì„ ì¶œë‹¨ê³„ ì´ì „ì— ìˆ˜í–‰í•˜ë„ë¡ êµ¬ì¶• limit
- íŒŒì´í”„ë¼ì¸ì„ êµ¬ì¶•í•  ë•Œ í•œ ë‹¨ê³„ì—ì„œ ë‹¤ë¥¸ ë‹¨ê³„ë¡œ ì „ë‹¬í•´ì•¼í•˜ëŠ” ë„íë¨¼íŠ¸ ìˆ˜ë¥¼ ë°˜ë“œì‹œ ì œí•œ
- ìˆœì„œê°€ ì¤‘ìš”í•˜ë‹¤ë©´ ì œí•œ ë‹¨ê³„ ì „ì— ì •ë ¬ì„ ìˆ˜í–‰ sort

```sql
db.companies.aggregate([
    {$match: {founded_year: 2004}}, // ì»¬ë ‰ì…˜ í•„í„°ë§ ë‹¨ê³„
    {$sort: {name: 1}}, // ì •ë ¬
    {$skip: 10}, // í•­ëª© ê±´ë„ˆë›°ê¸°
    {$limit: 5} // ë„íë¨¼íŠ¸ ì„ ì¶œ
    { // ë„íë¨¼íŠ¸ ëª¨ì–‘
        $project: {
            _id: 0,
            name: 1,
        }
    }
])
```

## $project

> ì¤‘ì²© í•„ë“œnested field()ë¥¼ ìŠ¹ê²©(promoting)í•˜ëŠ” ë°©ë²•

greylock íŒŒíŠ¸ë„ˆìŠ¤ê°€ ì°¸ì—¬í•œ í€ë”© ë¼ìš´ë“œë¥¼ í¬í•¨í•˜ëŠ” ëª¨ë“  íšŒì‚¬ë¥¼ í•„í„°ë§
- `$` ë¬¸ìëŠ” ì„ ì¶œ ë‹¨ê³„ì—ì„œ ê°’ ì§€ì •ì— ì‚¬ìš©ë˜ë©°, í•´ë‹¹ ê°’ì´ í•„ë“œ ê²½ë¡œë¡œ í•´ì„ë˜ê³  ê° í•„ë“œì—ì„œ ì„ ì¶œí•  ê°’ì„ ì„ íƒí•˜ëŠ” ë° ì‚¬ìš©

```sql
db.companies.aggregate([
    {$match: {"funding_rounds.investments.financial_org.permalink": "greylock"}},
    {
        $project: {
            _id: 0,
            name: 1,
            ipp: "$ipo.pub_year",
            valuation: "$ipo.valuation_amount",
            funders: "$funding_rounds.investments.financial_org.permalink"
        }
    }
])
```

## $unwind

ì…ë ¥ ë„íë¨¼íŠ¸ì—ì„œ ë°°ì—´ í•„ë“œ(key3)ë¥¼ ì „ê°œí•˜ë„ë¡ êµ¬ì„±ë  ë•Œ ì•„ë˜ì™€ ê°™ì€ ë„íë¨¼íŠ¸ë¥¼ ìƒì„±
- ì¦‰ ë°°ì—´ 10ê°œì˜ ìš”ì†Œê°€ ìˆìœ¼ë©´ ì „ê°œ ë‹¨ê³„ì—ì„œëŠ” 10ê°œì˜ ì¶œë ¥ ë„íë¨¼íŠ¸ê°€ ìƒì„±

```text
{ 
  key1 : "value1",
  key2 : "value2",
  key3 : ["elem1", "elem2", "elem3",]}
}

...

$unwind

{ 
  key1 : "value1",
  key2 : "value2",
  key3 : "elem1"
}
{ 
  key1 : "value1",
  key2 : "value2",
  key3 : "elem2"
}
{ 
  key1 : "value1",
  key2 : "value2",
  key3 : "elem3"
}
```

Example
- ê·¸ë ˆì´ë¡ì´ í•œ ë²ˆì´ë¼ë„ í€ë”© ë¼ìš´ë“œì— ì°¸ì—¬í•œ íšŒì‚¬ë¥¼ ë¨¼ì € í•„í„°ë§
- í€ë”© ë¼ìš´ë“œë¥¼ ì „ê°œí•˜ê³  
- ë‹¤ì‹œ í•„í„°ë§í•´ ê·¸ë ˆì´ë¡ì´ ì‹¤ì œ íŒœì—¬í•œ í€ë”© ë¼ìš´ë“œë¥¼ ë‚˜íƒ€ë‚´ëŠ” ë„íë¨¼íŠ¸ë§Œ ì„ ì¶œ ë‹¨ê³„ë¡œ ì „ë‹¬

```json
db.companies.aggregate([
    {$match: {"funding_rounds.investments.financial_org.permalink": "greylock"}},
    {$unwind: "$funding_rounds"},
    {$match: {"funding_rounds.investments.financial_org.permalink": "greylock"}},
    {
        $project: {
            _id: 0,
            name: 1,
            individualFunder: "$funding_rounds.investments.person.permalink",
            fundingOrganizaion: "$funding_rounds.investments.financial_org.permalink",
            amount: "$funding_rounds.raised_amount",
            year: "$funding_rounds.funded_year",
        }
    }
])
```

251
## ë°°ì—´ í‘œí˜„ì‹

## ëˆˆì‚°ê¸°

## ê·¸ë£¹í™”

# íŠ¸ëœì­ì…˜

# ì• í”Œë¦¬ì¼€ì´ì…˜ ì„¤ê³„