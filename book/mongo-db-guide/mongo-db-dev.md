# PART II. 몽고DB 개발

# 인덱싱

## 인덱싱 소개

> 인덱스를 사용하지 않는 쿼리를 컬렉션 스캔이라 하며,
>
> 서버가 쿼리 결과를 찾으려면 '전체 내용을 살펴봐야 함'을 의미

1️⃣ 인덱스 생성

> 인덱스를 만들려면 `createIndex` 컬렉션 메서드를 사용

```sql
db.users.createIndex({"username" : 1})
```

- 다른 셸에서 db.currentOp()를 실행하거나 mongod의 로그를 확인해 인덱스 구축의 진행률 체크 가능

인덱스는 쿼리 시간에 놀라운 차이를 만든다.
- 단점이라면, 인덱싱된 필드를 변경하는 쓰기(삽입, 갱신, 삭제) 작업은 오래 걸린다.
  - 데이터가 변경될 때마다 도큐먼트뿐 아니라 모든 인덱스를 갱신 필요
- 어떤 필드가 인덱싱하기에 적합한지 신중이 파악이 필요

{% hint style="info" %}

**몽고DB 인덱스**

전형적인 관계형 데이터베이스의 인덱스와 거의 동일하게 작동

{% endhint %}

인덱스를 생성할 필드를 선택하려면, 자주 쓰는 쿼리와 빨리 수행해야 하는 쿼리를 조사해 공통적인 키 셋을 찾아보자.

2️⃣ 복합 인덱스

> 두 개 이상의 필드로 구성된 인덱스
>
> 쿼리에서 정렬 방향이 여러 개이거나 검색 조건에 여러 개의 키가 있을 때 유용

몽고DB가 실행하는 쿼리 종류에 따라 인덱스를 사용하는 방법이 다른데 가장 많이 사용하는 세 가지 방법을 보자.

👉🏻 **단일 값을 찾는 동등 쿼리**

```sql
db.users.find({"age": 21}).sort({"username": -1})
```

👉🏻 **범용 쿼리**

```sql
db.users.find({"age": {"$gte": 31, "$lte": 30}})
```

👉🏻 **정렬이 포함된 다중값 쿼리**
- 결과를 반환하기 전에 메모리에서 정렬 작업을 수행하여 정렬 시간이 소요
- 속도는 검색 조건과 일치하는 결과가 얼마나 많은지에 따라 다름

```sql
db.users.find({"age": {"$gte": 31, "$lte": 30}}).sort({"username": 1})
```

{% hint style="info" %}

복합 인덱스를 구성할 때는 정렬 키를 첫 번째에 놓으면 좋다.

{% endhint %}












## explain 출력

## 인덱스를 생성하지 않는 이유

## 인덱스 종류

## 인덱스 관리

# 특수 인덱스와 컬렉션 유형

## 공간 정보 인덱스

## 전문 검색을 위한 인덱스

## 제한 컬렉션

## TTL 인덱스

## GridFS로 파일 저장하기

# 집계 프로임워크

# 트랜잭션

# 애플리케이션 설계