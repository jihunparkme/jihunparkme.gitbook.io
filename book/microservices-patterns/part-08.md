# Part 8. 외부 API 패턴

애플리케이션의 **외부 API를 설계하는 것은 클라이언트의 다양성으로 인해 매우 어렵습니다**.
* 클라이언트는 일반적으로 **서로 다른 데이터를 요구**하며(ex. 데스크톱 브라우저 UI는 모바일 앱보다 많은 정보 표시), **서로 다른 종류의 네트워크**를 통해 서비스에 접근합니다.
  * (방화벽 내부의 고성능 LAN vs. 방화벽 외부의 저성능 인터넷 또는 모바일 네트워크).
* 이 장에서는 다양한 외부 API 설계 문제를 설명하고, **API Gateway Pattern**과 **Back-ends for frontends Pattern**을 다룹니다. 
  * 또한 Spring Cloud Gateway 프레임워크나 GraphQL을 사용하여 API 게이트웨이를 설계하고 구현하는 방법을 설명합니다.

## 외부 API 설계 이슈







### 8.1 External API design issues (외부 API 설계 문제)

FTGO 애플리케이션을 예시로 들어 다양한 API 관련 문제들을 설명합니다. FTGO 애플리케이션의 서비스는 웹 애플리케이션, 브라우저 기반 JavaScript 애플리케이션, 모바일 애플리케이션, 그리고 서드파티 개발자 애플리케이션 등 **다양한 종류의 클라이언트에 의해 사용됩니다**. 이 중 웹 애플리케이션은 방화벽 내부에 있어 고대역폭, 저지연 LAN을 사용하고, 다른 클라이언트들은 방화벽 외부에 있어 저대역폭, 고지연 인터넷 또는 모바일 네트워크를 통해 서비스에 접근합니다.

클라이언트가 서비스를 직접 호출하는 방식은 마이크로서비스 아키텍처에서 다음과 같은 **심각한 단점들 때문에 거의 사용되지 않습니다**:

*   **세분화된 서비스 API로 인해 클라이언트가 필요한 데이터를 검색하기 위해 여러 번 요청을 해야 합니다**. 이는 비효율적이며 사용자 경험을 저해할 수 있습니다.
*   **클라이언트가 각 서비스와 그 API에 대해 알아야 하므로 캡슐화가 부족**하여 아키텍처 및 API 변경이 어렵습니다.
*   서비스가 클라이언트가 사용하기에 **불편하거나 실용적이지 않은 IPC(프로세스 간 통신) 메커니즘을 사용할 수 있습니다**.

다음은 클라이언트 유형별 주요 설계 문제입니다:

*   **FTGO 모바일 클라이언트를 위한 API 설계 문제**:
    *   **과도한 요청(Chatty API)으로 인한 사용자 경험 저하**: 모바일 애플리케이션은 주문 상세 정보를 표시하기 위해 여러 서비스(Order Service, Kitchen Service, Delivery Service, Accounting Service)에 여러 번 호출해야 합니다. 특히 인터넷이나 모바일 네트워크 환경에서는 **네트워크 지연 시간이 LAN보다 100배 이상 길어** 애플리케이션이 느리게 느껴질 수 있습니다. 또한, API 구성 코드가 복잡해지고 모바일 기기의 배터리 소모가 빨라집니다.
    *   **캡슐화 부족으로 인한 프런트엔드-백엔드 동기화 문제**: 서비스 API가 변경되거나 서비스 구조가 재편될 때 클라이언트 코드를 함께 업데이트해야 합니다. 모바일 애플리케이션의 업데이트 배포는 Apple이나 Google의 승인이 필요하여 **몇 시간에서 며칠이 걸릴 수 있으며**, 사용자가 즉시 업데이트하지 않을 수도 있어 API 진화에 큰 걸림돌이 됩니다.
    *   **클라이언트 친화적이지 않은 IPC 메커니즘**: 내부 서비스는 gRPC나 AMQP와 같은 프로토콜을 사용할 수 있지만, 방화벽 외부의 모바일 클라이언트는 HTTP나 WebSockets와 같은 프로토콜이 더 적합하여 직접 호출하기 어렵습니다.

*   **다른 종류의 클라이언트를 위한 API 설계 문제**:
    *   **웹 애플리케이션 (서버 측, 방화벽 내부)**: 전통적인 서버 측 웹 애플리케이션은 LAN 내부에서 실행되므로 **네트워크 대역폭 및 지연 시간이 문제가 되지 않습니다**. 비-웹 친화적인 프로토콜 사용도 가능하며, 백엔드 서비스 팀과 긴밀히 협력하므로 API 변경 시 쉽게 업데이트할 수 있어 **백엔드 서비스에 직접 접근하는 것이 실현 가능합니다**.
    *   **브라우저 기반 JavaScript 애플리케이션 (방화벽 외부)**: 서비스 API 변경 시 업데이트는 용이하지만, **인터넷을 통한 서비스 접근 시 모바일 애플리케이션과 동일한 네트워크 지연 문제를 겪습니다**. 특히 데스크톱용 UI는 더 정교하고 많은 서비스를 구성해야 하므로 비효율적일 수 있습니다.
    *   **서드파티 애플리케이션 (방화벽 외부)**: API 구성의 비효율성은 비교적 사소한 문제이며, **훨씬 더 큰 문제는 API의 안정성이 필수적이라는 점입니다**. 서드파티 개발자들에게 API 업그레이드를 강제하기 어려우며, 불안정한 API는 경쟁사로 개발자들을 잃게 할 위험이 있습니다. 따라서 **오래된 API 버전을 장기간 유지해야 하는 부담**이 있으며, 이는 백엔드 서비스 개발자들에게 큰 짐이 됩니다. 이러한 이유로 **서드파티 개발자에게 서비스를 직접 노출하는 대신 별도의 공용 API를 API 게이트웨이로 구현하여 제공해야 합니다**.

## API 게이트웨이 패턴

## API 게이트웨이 구현

## 마치며