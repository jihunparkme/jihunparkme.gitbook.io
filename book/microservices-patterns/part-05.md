# Part 5. 비즈니스 로직 설계

마이크로서비스 아키텍처에서 비즈니스 로직을 개발하는 것은 다음과 같은 두 가지 주요 과제 때문에 더욱 어렵습니다:
* **서비스 경계를 넘나드는 객체 참조 제거**: 
  * 일반적인 도메인 모델은 상호 연결된 클래스들의 복잡한 웹이지만, 마이크로서비스 아키텍처에서는 클래스들이 여러 서비스에 분산되어 있어 서비스 경계를 넘어선 객체 참조를 없애야 합니다.
* **분산 트랜잭션 관리**: 
  * 마이크로서비스 아키텍처의 트랜잭션 관리 제약 조건 내에서 작동하는 비즈니스 로직을 설계해야 합니다. 
  * 서비스 내에서는 ACID 트랜잭션을 사용할 수 있지만, **서비스 간 데이터 일관성을 유지하기 위해서는 사가(Saga) 패턴을 사용**해야 합니다.

이 장에서는 이러한 문제들을 해결하기 위해 다음과 같은 비즈니스 로직 조직화 패턴들을 다룹니다:
* **트랜잭션 스크립트(Transaction Script) 패턴**
* **도메인 모델(Domain Model) 패턴**
* **DDD 집계(Aggregate) 패턴**: 
  * 서비스의 비즈니스 로직을 집합(aggregate)으로 구조화하여 서비스 간 객체 참조 문제를 피하고, 
  * 단일 트랜잭션 내에서 단일 집합만 생성 또는 업데이트하도록 하여 마이크로서비스 트랜잭션 모델의 제약 조건에 부합하게 합니다.
* **도메인 이벤트(Domain Event) 패턴**: 서비스가 이벤트를 발행하는 것이 왜 유용한지 설명합니다.

## 비즈니스 로직 구성 패턴

이 섹션에서는 **서비스의 일반적인 아키텍처와 비즈니스 로직을 조직하는 두 가지 주요 패턴**인 `트랜잭션 스크립트 패턴`과 `도메인 모델 패턴`에 대해 설명합니다.

### 서비스 아키텍처와 어댑터

전형적인 서비스의 아키텍처는 **헥사고날 아키텍처(Hexagonal architecture)**를 따르며, **비즈니스 로직이 핵심(core)**을 이룹니다.  
비즈니스 로직 주변에는 인바운드(inbound) 어댑터와 아웃바운드(outbound) 어댑터가 있습니다.

<figure><img src="../../.gitbook/assets/microservices-patterns/5-1.png" alt=""><figcaption></figcaption></figure>

* **인바운드 어댑터**: 클라이언트의 요청을 처리하고 `비즈니스 로직을 호출`합니다.
  *   **REST API 어댑터**: REST API를 구현하여 비즈니스 로직을 호출하는 인바운드 어댑터입니다.
  *   **OrderCommandHandlers**: 메시지 채널에서 명령 메시지(command messages)를 소비하고 비즈니스 로직을 호출하는 인바운드 어댑터입니다.
* **아웃바운드 어댑터**: 비즈니스 로직에 의해 호출되며 `다른 서비스나 애플리케이션을 호출`합니다.
  *   **데이터베이스 어댑터(Database Adapter)**: 비즈니스 로직에 의해 호출되어 데이터베이스에 접근합니다.
  *   **도메인 이벤트 발행 어댑터(Domain Event Publishing Adapter)**: 메시지 브로커에 이벤트를 발행합니다.




## 도메인 모델 설계: DDD 애그리거트 패턴

## 도메인 이벤트 발행

## 주방 서비스 비즈니스 로직

## 주문 서비스 비즈니스 로직

## 마치며









