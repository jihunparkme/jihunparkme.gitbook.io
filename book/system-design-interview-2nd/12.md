---
description: 대규모 시스템 설계 기초 2nd 12장을 요약한 내용입니다.
---

결제 플랫폼은 일반적으로 고객에게 전자 지갑 서비스를 제공하여 고객으로 하여금 지갑에 돈을 넣어 두고 필요할 때 사용할 수 있도록 한다.

<figure><img src="../../.gitbook/assets/system-design-interview-2nd/12.1.png" alt=""><figcaption></figcaption></figure>

전자 지갑은 결제 기능뿐만 아니라 페이팔은 같은 플랫폼의 다른 사용자 지갑으로 직접 송금을 지원한다.
- 전자 지갑 간 이체는 은행 간 이체보다 빠르며, 일반적으로 추가 수수료를 부과하지 않느다.

# 1단계: 문제 이해 및 설계 범위 확정
 
설계할 전자 지갑
- 전자 지갑 간 이체
- 1,000,000TPS
- 99.99%의 안정성
- 트랜잭션
- 재현성

# 2단계: 개략적 설계안 제시 및 동의 구하기

## API 설계

**API**

|API|기능|
|:---|:---|
|POST /v1/wallet/balance_transfer|한 지갑에서 다른 지갑으로 자금 이체|

**요청 인자**

|필드|설명|자료형|
|---|---|---|
|from_account|자금을 인출할 계좌|string|
|to_account|자금을 이체할 계좌|string|
|amount|이체할 금액|string|
|currency|통화 단위|string(ISO 4217)|
|transaction_id|중복 제거에 사용할 ID|uuid|

응답 본문 사례:

```json
{
    "status": "success"
    "transaction_id": "01589980-2434-33dx-1532-1423gb420530"
}
```

## 인메모리 샤딩

모든 사용자 계정의 잔액을 유지하는 지갑 애플리케이션은 `<사용자, 잔액>` 관계를 나타내기 좋은 자료구조로 해시 테이블(Map, Key-value 저장소)을 사용한다.

인메모리 저장소로 인기 있는 선택지는 레디스.
- 그러나 레디스 노드 한 대로 100만 TPS 처리는 벅차다.
- 클러스터를 구성하고 사용자 계정을 모든 노드에 균등하게 분산시켜야 한다.
- 이 절차를 파티셔닝 또는 샤딩이라고 한다.


# 3단계: 상세 설계

# 4단계: 마무리

# 요약
