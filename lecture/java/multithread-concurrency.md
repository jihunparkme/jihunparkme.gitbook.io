# Multi-Thread And Concurrency

영한님의 [김영한의 실전 자바 - 고급 1편, 멀티스레드와 동시성](https://www.inflearn.com/course/%EA%B9%80%EC%98%81%ED%95%9C%EC%9D%98-%EC%8B%A4%EC%A0%84-%EC%9E%90%EB%B0%94-%EA%B3%A0%EA%B8%89-1/dashboard) 강의를 요약한 내용입니다.

## Process And Thread

### 멀티태스킹과 멀티프로세싱

**프로그램 실행**

> 프로그램을 구성하는 코드를 순서대로 CPU에서 연산(실행)하는 일

- CPU 코어가 하나일 경우, 한 번에 하나의 프로그램 코드만 실행
- 이를 해결하기 위해 하나의 CPU 코어로 여러 프로그램을 동시에 실행하는 `Multitasking` 기술 등장

#### ℹ️ Multitasking

> 하나의 컴퓨터 시스템이 동시에 여러 작업을 수행하는 능력
  - 운영체제가 스케줄링을 수행하고, CPU를 최대한 사용하면서 작업이 골고루 수행될 수
있게 최적화
- 현대의 CPU는 초당 수십억 번 이상의 연산을 수행
  - CPU가 매우 빠르게 두 프로그램의 코드를 번갈아 수행한다면, 사람이 느낄 때 두 프로그램이 동시에 실행되는 것처럼 느껴짐
  - 시분할(Time Sharing) 기법: 프로그램의 실행 시간을 분할해서 마치 동시에 실행되는 것 처럼 하는 기법

#### ℹ️ Multiprocessing

> 컴퓨터 시스템에서 둘 이상의 프로세서(CPU Core)를 사용하여 여러 작업을 동시에 처리하는 기술

- 하나의 CPU 안에 보통 2개 이상의 코어
- 멀티프로세싱 시스템은 하나의 CPU 코어만을 사용하는 시스템보다 동시에 더 많은 작업
을 처리

**Multiprocessing VS. Multitasking**

|Multiprocessing|Multitasking|
|---|---|
|여러 CPU(여러 CPU 코어)를 사용하여 동시에 여러 작업을 수행하는 것을 의미|단일 CPU(단일 CPU 코어)가 여러 작업을 동시에 수행하는 것처럼 보이게 하는 것|
|하드웨어 기반으로 성능을 향상|소프트웨어 기반으로 CPU 시간을 분할하여 각 작업에 할당|
|다중 코어 프로세서를 사용하는 현대 컴퓨터 시스템| 현대 운영 체제에서 여러 애플리케이션이 동시에 실행되는 환경|

...

### 프로세스와 스레드

#### ℹ️ Proccess

> 운영체제 안에서 실행중인 프로그램

- 프로세스는 실행 중인 프로그램의 인스턴스
  - 각 프로세스는 독립적인 메모리 공간을 갖고 있으며, 운영체제에서 별도의 작업 단위로 분리해서 관리
  - 프로세스가 서로의 메모리에 직접 접근/간섭할 수 없다
- 자바 언어로 비유를 하자면 클래스는 프로그램이고, 인스턴스는 프로세스

**프로세스의 메모리 구성**
- Code Section: 실행할 프로그램의 코드가 저장되는 부분
- Data Section: 전역 변수 및 정적 변수가 저장되는 부분
- Heap: 동적으로 할당되는 메모리 영역
- Stack: 메서드(함수) 호출 시 생성되는 지역 변수와 반환 주소가 저장되는 영역(스레드에 포함)

#### ℹ️ Thread

> 프로세스 내에서 실행되는 작업의 단위

- 프로세스는 하나 이상의 스레드를 반드시 포함
  - 한 프로세스 내에서 여러 스레드가 존재할 수 있으며, 이들은 프로세스가 제공하는 동일한 메모리 공간을 공유(단일 스레드, 멀티 스레드)
  - 프로세스보다 단순하므로 생성 및 관리가 단순하고 가볍
- 하나의 프로그램도 그 안에서 동시에 여러 작업이 필요하므로 멀티스레드가 필요

**메모리 구성**
- 공유 메모리: 같은 프로세스의 코드 섹션, 데이터 섹션, 힙(메모리)은 프로세스 안의 모든 스레드가 공유
- 개별 스택: 각 스레드는 자신의 스택을 보유

`프로세스`는 실행 환경과 자원을 제공하는 컨테이너 역할, `스레드`는 CPU를 사용해서 코드를 하나하나 실행하는 역할

...

### 스레드와 스케줄링

**단일 코어 스케줄링**
- 운영체제는 내부에 스케줄링 큐를 가지고 있고, 각 스레드는 스케줄링 큐에서 대기
- 각 스레드는 번갈아가면서 코드를 실행

**멀티 코어 스케줄링**
- CPU 코어가 2개 이상이면 한 번에 더 많은 스레드를 물리적으로 동시에 실행

**프로세스, 스레드와 스케줄링**
- 멀티태스킹과 스케줄링
  - `멀티태스킹`은 동시에 여러 작업을 수행하는 것을 의미
  - 이를 위해 운영체제는 `스케줄링`이라는 기법을 사용
  - `스케줄링`은 CPU 시간을 여러 작업에 나누어 배분하는 방법
- 프로세스와 스레드
  - `프로세스`는 실행 중인 프로그램의 인스턴스
    - 각 프로세스는 독립적인 메모리 공간을 가지며, 운영체제에서 독립된 실행 단위로 취급
  - `스레드`는 프로세스 내에서 실행되는 작은 단위
    - 여러 스레드는 하나의 프로세스 내에서 자원을 공유하며, 프로세스의 코드, 데이터, 시스템 자원등을 공유
    - 실제로 CPU에 의해 실행되는 단위는 스레드
- 프로세스의 역할
  - `프로세스`는 실행 환경(컨테이너 역할)을 제공
    - 메모리 공간, 파일 핸들, 시스템 자원(네트워크 연결) 등이 포함
  - 프로세스 자체는 운영체제의 스케줄러에 의해 직접 실행되지 않으며, **프로세스 내의 스레드가 실행**
    - 1개의 프로세스 안에 하나의 스레드만 실행되는 경우도 있고, 여러 스레드가 실행되는 경우도 존재

...

### 컨텍스트 스위칭

**컨텍스트 스위칭(context switching)**
- 스레드A를 멈추는 시점에 CPU에서 사용하던 값들을 메모리에 저장해두어야 한다. 
- 그리고 이후에 스레드A를 다시 실행할 때 이 값들을 CPU에 다시 불러오는 과정

**멀티스레드는 대부분 효율적이지만, 컨텍스트 스위칭 과정이 필요하므로 항상 효율적인 것은 아니다**
- 현재 작업하는 문맥이 변하기 때문에 컨텍스트(현재 작업하는 문맥) 스위칭
  - 컨텍스트 스위칭 과정에서 이전에 실행 중인 값을 메모리에 잠깐 저장하고,
  - 이후에 다시 실행하는 시점에 저장한 값을 CPU에 다시 불러와야 한다.
- 컨텍스트 스위칭 과정에는 약간의 비용이 발생
  - 연산 시간 + 컨텍스트 스위칭 시간
- 실제로 컨텍스트 스위칭에 걸리는 시간은 아주 짧지만 스레드가 매우 많다면 이 비용이 커질 수 있음











...

## Section

### Sub Section

#### ℹ️

...

### Sub Section

---

## Section